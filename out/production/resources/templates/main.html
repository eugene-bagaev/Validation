<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Task Validation</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
</head>

<style>
    table {
        border-collapse: collapse;
    }

    table, th, td {
        border: 1px solid black;
        padding: 10px;
    }
    .table-cell {
        padding-left: 20px;
        padding-right: 20px;
    }
    .table-cell-heading {
        padding-left: 40px;
        padding-right: 40px;
    }
    .button-home {
        padding-top: 10px;
        padding-bottom: 10px;
    }
</style>

<script>
    var selectedUsers = [];

    function summurizeSelectedUsers(value, name) {
        console.log(name);
        if (value && value === true && value !== undefined) {
            selectedUsers.push(name);
        } else {
            selectedUsers.splice(selectedUsers.indexOf(name), 1);
        }
    }
    function runTaskForSelectedUsers() {
        var xhr = new XMLHttpRequest();
        var body = selectedUsers;

        xhr.open("POST", '/task/online-course/check', true);

        xhr.onload = function () {
            console.log('State: ', this.readyState);
            console.log('Status: ', this.status);
            console.log(JSON.parse(this.responseText).body);
        };

        xhr.send(body);
    }


</script>

<body style="background: #c6c6c6;">

    <div id="main-container" style="width: 90%;border: 1px solid gray; background: white; margin: 30px auto 30px; padding: 40px">

        <div style="text-align: center;width: 100%">
            <h1>Task Checker Main Page</h1>
        </div>

        <div class="button-home">
            <button onclick="runTaskForSelectedUsers()">Run task for selected user(s)</button>
            <button>Refresh users creds</button>
            <button>Run all tasks</button>
        </div>

        <table style="border: 1px solid black; padding: 5px">
            <thead>
                <td class="table-cell-heading">Action</td>
                <td class="table-cell-heading">User</td>
                <td class="table-cell-heading">Login</td>
                <td class="table-cell-heading">Password</td>
            </thead>
            <tbody>
                <tr th:each="user: ${users}" style="padding: 5px;text-align: center" class="table-cell">
                    <td class="table-cell">
                        <input type="checkbox" th:id="${user.username}" onchange="summurizeSelectedUsers(this.checked, this.id)" />
                    </td>
                    <td th:text="${user.name}"      class="table-cell" />
                    <td th:text="${user.username}"  class="table-cell"/>
                    <td th:text="${user.password}"  class="table-cell"/>
                </tr>
            </tbody>

        </table>

    </div>

</body>

</html>